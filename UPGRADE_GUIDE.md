# การปรับปรุงระบบการแสดงผลหน้าแรก

## สรุปการเปลี่ยนแปลง

การปรับปรุงครั้งนี้ได้เพิ่มฟีเจอร์การตั้งค่าไตรมาสเริ่มต้น (Default Quarter) และการจัดการไตรมาสที่แอคทีฟ (Active Quarter) ให้กับระบบ

## ไฟล์ที่มีการเปลี่ยนแปลง

### 1. `upgrade_database.sql` (ไฟล์ใหม่)
**วัตถุประสงค์:** อัปเกรดโครงสร้างฐานข้อมูล
**การเปลี่ยนแปลง:**
- เพิ่มฟิลด์ `is_default` (BOOLEAN) เพื่อระบุการตั้งค่าเริ่มต้น
- เพิ่มฟิลด์ `active_quarter` (INT) เพื่อระบุไตรมาสที่ควรแอคทีฟ
- เพิ่ม index เพื่อประสิทธิภาพ
- สคริปต์ migration เพื่อตั้งค่าเริ่มต้น

### 2. `pages/home.php`
**วัตถุประสงค์:** ใช้การตั้งค่าไตรมาสเริ่มต้น
**การเปลี่ยนแปลง:**
- เพิ่มการหาการตั้งค่าเริ่มต้น (`defaultConfig`)
- ใช้ `active_quarter` จากการตั้งค่าเริ่มต้น
- ตั้งค่าไตรมาสเริ่มต้นเป็น 3 (ตามความต้องการ)

### 3. `pages/manage_home_display.php`
**วัตถุประสงค์:** จัดการการตั้งค่าไตรมาสเริ่มต้น
**การเปลี่ยนแปลง:**
- เพิ่มฟิลด์ checkbox `is_default` ในฟอร์ม
- เพิ่มฟิลด์ dropdown `active_quarter` ในฟอร์ม
- ปรับปรุงการแสดงผลให้เห็นสถานะการตั้งค่าเริ่มต้น
- ใช้ transaction เพื่อความปลอดภัยของข้อมูล
- ปรับปรุงฟังก์ชัน JavaScript

## คำแนะนำการติดตั้ง

### ขั้นตอนที่ 1: อัปเกรดฐานข้อมูล
```sql
-- รันคำสั่ง SQL ในไฟล์ upgrade_database.sql
mysql -u [username] -p [database_name] < upgrade_database.sql
```

### ขั้นตอนที่ 2: อัปโหลดไฟล์ที่แก้ไข
- `pages/home.php`
- `pages/manage_home_display.php`

### ขั้นตอนที่ 3: ทดสอบระบบ
1. เข้าสู่ระบบด้วยสิทธิ์ admin
2. ไปที่หน้าจัดการการแสดงผล (manage_home_display.php)
3. ทดสอบการเพิ่ม/แก้ไข/ลบการตั้งค่า
4. ทดสอบการตั้งค่าเริ่มต้นและไตรมาสแอคทีฟ
5. ตรวจสอบหน้าแรก (home.php) ว่าใช้การตั้งค่าที่ถูกต้อง

## ฟีเจอร์ใหม่

### 1. การตั้งค่าเริ่มต้น (Default Configuration)
- สามารถกำหนดให้การตั้งค่าใดเป็นค่าเริ่มต้นได้
- ระบบจะใช้การตั้งค่าเริ่มต้นเมื่อผู้ใช้เข้าหน้าแรกครั้งแรก
- มีไอคอนดาวและข้อความ "ค่าเริ่มต้น" แสดงในรายการ

### 2. ไตรมาสแอคทีฟ (Active Quarter)
- สามารถกำหนดได้ว่าไตรมาสใดควรแอคทีฟเป็นค่าเริ่มต้น
- ค่าเริ่มต้นคือไตรมาส 3 (ตามความต้องการ)
- แสดงข้อมูล "แอคทีฟ Q[หมายเลข]" ในการตั้งค่าเริ่มต้น

### 3. ตัวบ่งชี้สถานะ
- แสดงสถานะการตั้งค่าต่างๆ ด้วยสีและไอคอน
- "ค่าเริ่มต้น" = ไอคอนดาวสีเหลือง
- "แอคทีฟ Q[หมายเลข]" = ไอคอนเล่นสีเขียว

## การใช้งาน

### สำหรับ Administrator
1. **เพิ่มการตั้งค่าใหม่:**
   - คลิก "เพิ่มการตั้งค่า"
   - กรอกข้อมูลปี/ไตรมาสที่จะแสดง
   - กรอกข้อมูลต้นฉบับที่จะนำมาแสดง
   - เลือก "ตั้งเป็นค่าเริ่มต้น" หากต้องการ
   - เลือกไตรมาสที่แอคทีฟ (ค่าเริ่มต้น: ไตรมาส 3)

2. **แก้ไขการตั้งค่า:**
   - คลิกปุ่มแก้ไข (สีส้ม)
   - ปรับแต่งค่าตามต้องการ
   - กด "บันทึก"

3. **ลบการตั้งค่า:**
   - คลิกปุ่มลบ (สีแดง)
   - ยืนยันการลบ

### สำหรับ End User
- เมื่อเข้าหน้าแรก ระบบจะแสดงไตรมาสที่กำหนดเป็น active_quarter
- หากไม่มีการตั้งค่าเริ่มต้น ระบบจะแสดงไตรมาส 3
- ยังสามารถเปลี่ยนไตรมาสได้ตามปกติ

## ข้อมูลเทคนิค

### ฟิลด์ใหม่ในฐานข้อมูล
```sql
ALTER TABLE home_display_config 
ADD COLUMN is_default BOOLEAN NOT NULL DEFAULT FALSE,
ADD COLUMN active_quarter INT(11) NOT NULL DEFAULT 1;
```

### ค่าเริ่มต้น
- `is_default`: FALSE (ไม่ใช่ค่าเริ่มต้น)
- `active_quarter`: 1 (ไตรมาส 1) - แต่ในโค้ดใช้ 3 เป็นค่าเริ่มต้น

### การรักษาความปลอดภัยข้อมูล
- ใช้ transaction เมื่อบันทึกข้อมูล
- ตรวจสอบว่ามีการตั้งค่าเริ่มต้นเพียงหนึ่งรายการ
- ใช้ prepared statements เพื่อป้องกัน SQL injection

## ปัญหาที่อาจเกิดขึ้น

### 1. ฐานข้อมูลไม่ได้อัปเกรด
**อาการ:** Error เกี่ยวกับฟิลด์ is_default หรือ active_quarter
**วิธีแก้:** รันสคริปต์ upgrade_database.sql

### 2. ไม่มีการตั้งค่าเริ่มต้น
**อาการ:** หน้าแรกแสดงไตรมาส 3 เสมอ
**วิธีแก้:** ตั้งค่าเริ่มต้นในหน้าจัดการ

### 3. ข้อมูลไม่ตรงกัน
**อาการ:** การตั้งค่าเริ่มต้นหลายรายการ
**วิธีแก้:** รันสคริปต์ SQL เพื่อเคลียร์ค่าเริ่มต้นซ้ำ

## การทดสอบ

ระบบได้ผ่านการทดสอบแล้ว:
- ✅ การตรวจสอบ PHP syntax
- ✅ การตรวจสอบ SQL script
- ✅ การตรวจสอบฟิลด์ในฟอร์ม
- ✅ การตรวจสอบลอจิกในหน้าแรก

## การสนับสนุน

หากพบปัญหาในการใช้งาน กรุณาตรวจสอบ:
1. การอัปเกรดฐานข้อมูลถูกต้อง
2. ไฟล์ PHP ถูกอัปโหลดครบถ้วน
3. สิทธิ์การเข้าถึงฐานข้อมูลถูกต้อง
4. Browser cache ถูกล้างแล้ว