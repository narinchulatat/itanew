<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select2 Fixed Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        /* Enhanced Select2 dropdown styling for modal - FIXED VERSION */
        #testModal .select2-container .select2-dropdown {
            max-width: calc(100% - 4rem) !important;
            width: calc(100% - 4rem) !important;
            min-width: 200px !important;
            box-sizing: border-box !important;
            z-index: 99999 !important;
            word-break: break-word;
            white-space: normal;
            position: absolute !important;
        }
        
        #testModal .select2-container .select2-results__option {
            max-width: 100% !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            word-break: break-word !important;
            padding: 0.5rem !important;
            box-sizing: border-box !important;
        }
        
        /* Ensure dropdown doesn't exceed modal boundaries - improved positioning */
        #testModal .select2-container--open .select2-dropdown {
            left: 2rem !important;
            right: 2rem !important;
            margin: 0 !important;
            transform: none !important;
        }
        
        /* Additional constraint for dropdown container positioning */
        #testModal .select2-container--open .select2-dropdown--below {
            border-top: none !important;
        }
        
        #testModal .select2-container--open .select2-dropdown--above {
            border-bottom: none !important;
        }
        
        /* Responsive Select2 adjustments */
        @media (max-width: 640px) {
            #testModal .select2-container .select2-dropdown {
                max-width: calc(100vw - 3rem) !important;
                width: calc(100vw - 3rem) !important;
                left: 1.5rem !important;
                right: 1.5rem !important;
            }
            #testModal .select2-container .select2-results__option {
                font-size: 0.9rem !important;
                padding: 0.4rem !important;
            }
        }
        
        /* Modal content overflow handling */
        #testModal .bg-white {
            overflow: visible !important;
            position: relative !important;
        }
        
        #testModal {
            overflow: visible !important;
        }
        
        .modal-demo {
            max-width: 600px; /* Constrained width to test overflow prevention */
            position: relative !important;
            overflow: visible !important;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <h1 class="text-2xl font-bold mb-4">Select2 Dropdown Fixed Version</h1>
    <button onclick="openModal()" class="bg-green-600 text-white px-4 py-2 rounded">Open Fixed Modal</button>
    
    <!-- Modal with constrained width to test fixed overflow -->
    <div id="testModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center" style="display: none;">
        <div class="modal-demo bg-white rounded-lg p-6 w-full mx-4">
            <h2 class="text-lg font-bold mb-4">Fixed Modal (600px max-width)</h2>
            
            <div class="mb-4">
                <label class="block mb-2">Select with long options (FIXED CSS):</label>
                <select id="testSelect" class="w-full border rounded px-3 py-2">
                    <option value="">Choose an option</option>
                    <option value="1">Very long option text that could potentially overflow the modal boundaries and cause layout issues when displayed in Select2 dropdown</option>
                    <option value="2">Another extremely long option with even more text to demonstrate overflow behavior in constrained modal environment</option>
                    <option value="3">Super long category name: การจัดการเอกสารระบบบริหารคุณภาพและความปลอดภัยผู้ป่วยในโรงพยาบาลระดับตติยภูมิ</option>
                    <option value="4">Maximum length test option: ระบบการเงินและงบประมาณสำหรับการบริหารจัดการองค์กรภาครัฐและเอกชนในยุคดิจิทัล</option>
                    <option value="5">Even longer test: การบริหารจัดการทรัพยากรมนุษย์และการพัฒนาบุคลากรในองค์กรภาครัฐสำหรับการให้บริการประชาชนอย่างมีประสิทธิภาพ</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block mb-2">Second dropdown:</label>
                <select id="testSelect2" class="w-full border rounded px-3 py-2">
                    <option value="">Another dropdown</option>
                    <option value="1">Normal option</option>
                    <option value="2">Longer option text to test behavior</option>
                    <option value="3">Very long subcategory name for comprehensive testing of dropdown overflow behavior</option>
                </select>
            </div>
            
            <div class="flex justify-between">
                <button onclick="closeModal()" class="bg-gray-500 text-white px-4 py-2 rounded">Close</button>
                <button class="bg-green-600 text-white px-4 py-2 rounded">Save</button>
            </div>
        </div>
    </div>

    <script>
        function openModal() {
            $('#testModal').removeClass('hidden').show();
            
            // Initialize Select2 with dropdownParent after modal is shown
            setTimeout(function() {
                $('#testSelect, #testSelect2').select2({
                    width: '100%',
                    dropdownParent: $('#testModal'),
                    minimumResultsForSearch: Infinity, // Disable search for demo
                    placeholder: 'Choose an option'
                });
            }, 100);
        }
        
        function closeModal() {
            $('#testModal').addClass('hidden').hide();
            $('#testSelect, #testSelect2').select2('destroy');
        }
    </script>
</body>
</html>